# [04.06] Spark 분산처리

## matching-spark
### 구성 요소
1. 임베딩 생성기 (embedding_generator.py)

MySQL에서 분실물 데이터를 가져와 CLIP 모델로 텍스트와 이미지 임베딩을 생성합니다
생성된 임베딩을 Hadoop에 저장하여 나중에 Spark에서 활용할 수 있게 합니다
배치 처리 방식으로 대용량 데이터도 효율적으로 처리합니다

2. 스파크 유사도 매칭 처리기 (spark_similarity_matcher.py)

Hadoop에 저장된 임베딩 데이터를 Spark로 불러와 분산 처리합니다
사용자 게시글에 대한 임베딩을 생성하고 기존 임베딩과 유사도를 계산합니다
코사인 유사도 기반으로 유사한 분실물을 찾아 결과를 반환합니다

3. 스파크 API 라우터 (spark_routers.py)

FastAPI와 Spark 매칭 처리기를 연결하는 API 라우터입니다
사용자 요청을 받아 스파크 매칭 기능을 호출하고 결과를 반환합니다

4. 임베딩 업데이트 스케줄러 (embedding_scheduler.py)

설정된 주기(기본 24시간)로 임베딩 생성 및 저장 작업을 자동 실행합니다
새로운 분실물 데이터가 추가되어도 자동으로 임베딩이 업데이트됩니다

### 시스템 흐름
1. 임베딩 생성 및 저장 과정:

스케줄러가 주기적으로 임베딩 생성기를 실행합니다
MySQL에서 분실물 데이터를 가져와 CLIP 모델로 임베딩을 생성합니다
생성된 임베딩을 Hadoop에 JSON 형식으로 저장합니다

2. 사용자 요청 처리 과정:

사용자가 분실물 게시글을 API로 전송합니다
FastAPI 라우터가 요청을 받아 스파크 매칭 기능을 호출합니다
스파크에서 Hadoop의 임베딩 데이터를 불러와 유사도를 계산합니다
유사도가 높은 분실물을 찾아 결과를 사용자에게 반환합니다